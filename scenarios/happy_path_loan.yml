# Happy Path Loan Scenario
# Complete loan lifecycle: customer → approval → disbursal → payments → completion

name: happy_path_loan
description: Customer applies for loan, gets approved, makes payments, completes
seed: 42000
start_time: "2024-01-01T09:00:00Z"

events:
  # ========================================
  # Day 0: Customer Onboarding
  # ========================================
  - event: CustomerEvent::Initialized
    entity: customer_1
    values:
      email: "loan.customer@example.com"
      customer_type: Individual
      level: Verified
      activity: Active

  - event: DepositAccountEvent::Initialized
    entity: deposit_1
    after: 1h
    values:
      customer_id_ref: customer_1

  # ========================================
  # Day 1: Initial Deposit
  # ========================================
  - event: DepositEvent::Initialized
    entity: deposit_tx_1
    after: 24h
    values:
      deposit_account_id_ref: deposit_1
      amount: 10000000  # $100,000 in cents

  # ========================================
  # Day 2: Terms Template Setup
  # ========================================
  - event: TermsTemplateEvent::Initialized
    entity: terms_1
    after: 24h
    values:
      name: "Standard 12-month Loan"
      values:
        annual_rate: "0.12"
        duration:
          Months: 12
        interest_due_duration_from_accrual:
          Days: 30
        accrual_cycle_interval: EndOfMonth
        accrual_interval: EndOfDay
        one_time_fee_rate: "0.01"
        liquidation_cvl:
          Finite: "1.10"
        margin_call_cvl:
          Finite: "1.25"
        initial_cvl:
          Finite: "1.50"
        disbursal_policy: SingleDisbursal

  # ========================================
  # Day 3: Loan Application
  # ========================================
  - event: CreditFacilityProposalEvent::Initialized
    entity: proposal_1
    after: 24h
    values:
      customer_id_ref: customer_1
      amount: 1000000  # $10,000 in cents
      customer_type: Individual
      status: PendingCustomerApproval
      terms:
        annual_rate: "0.12"
        duration:
          Months: 12
        interest_due_duration_from_accrual:
          Days: 30
        accrual_cycle_interval: EndOfMonth
        accrual_interval: EndOfDay
        one_time_fee_rate: "0.01"
        liquidation_cvl:
          Finite: "1.10"
        margin_call_cvl:
          Finite: "1.25"
        initial_cvl:
          Finite: "1.50"
        disbursal_policy: SingleDisbursal

  - event: CreditFacilityProposalEvent::CustomerApprovalConcluded
    entity: proposal_1
    after: 2h
    values:
      status: PendingApproval

  # ========================================
  # Day 4: Committee Approval
  # ========================================
  - event: ApprovalProcessEvent::Initialized
    entity: approval_1
    after: 24h

  - event: ApprovalProcessEvent::Approved
    entity: approval_1
    after: 4h

  - event: ApprovalProcessEvent::Concluded
    entity: approval_1
    after: 1h
    values:
      approved: true

  - event: CreditFacilityProposalEvent::ApprovalProcessConcluded
    entity: proposal_1
    after: 1m
    values:
      approval_process_id_ref: approval_1
      status: Approved

  # ========================================
  # Day 5: Collateral & Pending Facility
  # ========================================
  - event: CollateralEvent::Initialized
    entity: collateral_1
    after: 24h

  - event: CollateralEvent::UpdatedViaManualInput
    entity: collateral_1
    after: 1h
    values:
      collateral: 50000000  # 0.5 BTC in satoshis

  - event: PendingCreditFacilityEvent::Initialized
    entity: pending_1
    after: 1h
    values:
      credit_facility_proposal_id_ref: proposal_1
      customer_id_ref: customer_1
      collateral_id_ref: collateral_1
      amount: 1000000

  - event: PendingCreditFacilityEvent::CollateralizationStateChanged
    entity: pending_1
    after: 1h
    values:
      collateralization_state: FullyCollateralized
      collateral: 50000000
      price: "50000.00"

  - event: PendingCreditFacilityEvent::Completed
    entity: pending_1
    after: 1h

  # ========================================
  # Day 6: Credit Facility Activation
  # ========================================
  - event: CreditFacilityEvent::Initialized
    entity: facility_1
    after: 24h
    values:
      pending_credit_facility_id_ref: pending_1
      customer_id_ref: customer_1
      collateral_id_ref: collateral_1
      amount: 1000000
      collateralization_state: FullyCollateralized
      collateral: 50000000
      price: "50000.00"
      terms:
        annual_rate: "0.12"
        duration:
          Months: 12
        interest_due_duration_from_accrual:
          Days: 30
        accrual_cycle_interval: EndOfMonth
        accrual_interval: EndOfDay
        one_time_fee_rate: "0.01"
        liquidation_cvl:
          Finite: "1.10"
        margin_call_cvl:
          Finite: "1.25"
        initial_cvl:
          Finite: "1.50"
        disbursal_policy: SingleDisbursal

  # ========================================
  # Day 7: Disbursal
  # ========================================
  - event: DisbursalEvent::Initialized
    entity: disbursal_1
    after: 24h
    values:
      credit_facility_id_ref: facility_1
      amount: 1000000

  - event: DisbursalEvent::ApprovalProcessConcluded
    entity: disbursal_1
    after: 4h
    values:
      approved: true

  - event: DisbursalEvent::Settled
    entity: disbursal_1
    after: 1h

  # ========================================
  # Day 30: First Interest Accrual
  # ========================================
  - event: CreditFacilityEvent::InterestAccrualCycleStarted
    entity: facility_1
    after: 23d
    values:
      interest_accrual_cycle_idx: 1

  - event: InterestAccrualCycleEvent::Initialized
    entity: accrual_1
    after: 1m
    values:
      credit_facility_id_ref: facility_1

  - event: CreditFacilityEvent::InterestAccrualCycleConcluded
    entity: facility_1
    after: 1h
    values:
      interest_accrual_cycle_idx: 1

  # ========================================
  # Day 35: First Interest Payment
  # ========================================
  - event: PaymentEvent::Initialized
    entity: payment_1
    after: 5d
    values:
      credit_facility_id_ref: facility_1
      amount: 10000  # $100 interest

  - event: ObligationEvent::Initialized
    entity: obligation_1
    after: 1m
    values:
      credit_facility_id_ref: facility_1

  - event: ObligationEvent::Completed
    entity: obligation_1
    after: 1h

  # ========================================
  # Day 90: Maturity
  # ========================================
  - event: CreditFacilityEvent::Matured
    entity: facility_1
    after: 55d

  - event: CreditFacilityEvent::Completed
    entity: facility_1
    after: 1d
